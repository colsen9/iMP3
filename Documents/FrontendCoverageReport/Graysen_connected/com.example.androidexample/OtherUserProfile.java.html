<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OtherUserProfile.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debug</a> &gt; <a href="index.source.html" class="el_package">com.example.androidexample</a> &gt; <span class="el_source">OtherUserProfile.java</span></div><h1>OtherUserProfile.java</h1><pre class="source lang-java linenums">package com.example.androidexample;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.os.Bundle;
import android.util.Base64;
import android.util.Log;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;
import com.android.volley.Request;
import com.android.volley.RequestQueue;
import com.android.volley.toolbox.JsonObjectRequest;
import com.google.android.flexbox.FlexboxLayout;
import org.json.JSONArray;

<span class="nc" id="L21">public class OtherUserProfile extends AppCompatActivity {</span>
    private Button music, lists;
    private Button friends, back;
    private ImageView profilePicture;
    private TextView bioView, fullname, spotifyStatusText;
<span class="nc" id="L26">    private int userId = -1;</span>
<span class="nc" id="L27">    private int otherUserId = -1;</span>
    private RequestQueue requestQueue;
    private static final String BASE_URL = &quot;http://coms-3090-027.class.las.iastate.edu:8080&quot;;
    private TagManager tagService;
    private UserTagUIManager userTagUIManager;
    private FlexboxLayout userTagContainer;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
<span class="nc" id="L36">        super.onCreate(savedInstanceState);</span>
<span class="nc" id="L37">        setContentView(R.layout.other_user_page);</span>

        /* initialize UI elements */
<span class="nc" id="L40">        profilePicture = findViewById(R.id.profile_picture);</span>
<span class="nc" id="L41">        friends = findViewById(R.id.friends_btn);</span>
<span class="nc" id="L42">        bioView = findViewById(R.id.user_bio);</span>
<span class="nc" id="L43">        music = findViewById(R.id.music_btn);</span>
<span class="nc" id="L44">        lists = findViewById(R.id.lists_btn);</span>
<span class="nc" id="L45">        fullname = findViewById(R.id.user_fullname);</span>
<span class="nc" id="L46">        spotifyStatusText = findViewById(R.id.spotify_status_text);</span>
<span class="nc" id="L47">        back = findViewById(R.id.backButton);</span>
<span class="nc" id="L48">        userTagContainer = findViewById(R.id.userTagContainer);</span>
<span class="nc" id="L49">        userTagUIManager = new UserTagUIManager(this, userTagContainer);</span>
<span class="nc" id="L50">        tagService = new TagManager(this);</span>


        /* initialize Volley */
<span class="nc" id="L54">        requestQueue = QueueApplication.getQueue();</span>

        /* retrieve userId from previous activity */
<span class="nc" id="L57">        Intent intent = getIntent();</span>
<span class="nc" id="L58">        userId = intent.getIntExtra(&quot;userId&quot;, -1);</span>
<span class="nc" id="L59">        otherUserId = intent.getIntExtra(&quot;otherUserId&quot;, -1);</span>
<span class="nc" id="L60">        Log.i(&quot;UserId : otherUserId&quot;, userId + &quot; : &quot; + otherUserId);</span>

<span class="nc" id="L62">        loadUserTags();</span>
<span class="nc bnc" id="L63" title="All 4 branches missed.">        if (userId == -1 &amp;&amp; savedInstanceState != null) {</span>
<span class="nc" id="L64">            userId = savedInstanceState.getInt(&quot;userId&quot;, -1);</span>
        }
<span class="nc bnc" id="L66" title="All 4 branches missed.">        if (otherUserId == -1 &amp;&amp; savedInstanceState != null) {</span>
<span class="nc" id="L67">            otherUserId = savedInstanceState.getInt(&quot;otherUserId&quot;, -1);</span>
        }

<span class="nc bnc" id="L70" title="All 2 branches missed.">        if (otherUserId == -1) {</span>
<span class="nc" id="L71">            Toast.makeText(this, &quot;Error: No profile specified&quot;, Toast.LENGTH_SHORT).show();</span>
<span class="nc" id="L72">            finish();</span>
<span class="nc" id="L73">            return;</span>
        }

        /* set onClickListeners for music catalogue and pass the current user id */
<span class="nc" id="L77">        music.setOnClickListener(v -&gt; {</span>
<span class="nc" id="L78">            Intent tempMain = new Intent(OtherUserProfile.this, MusicCatalogue.class);</span>
<span class="nc" id="L79">            tempMain.putExtra(&quot;userId&quot;, userId);</span>
<span class="nc" id="L80">            startActivity(tempMain);</span>
<span class="nc" id="L81">        });</span>

        /* set onClickListeners for custom lists view and pass the current user id */
<span class="nc" id="L84">        lists.setOnClickListener(v -&gt; {</span>
<span class="nc" id="L85">            Intent tempMain = new Intent(OtherUserProfile.this, CustomListListPage.class);</span>
<span class="nc" id="L86">            tempMain.putExtra(&quot;userId&quot;, otherUserId);</span>
<span class="nc" id="L87">            startActivity(tempMain);</span>
<span class="nc" id="L88">        });</span>

        /* set onClickListeners for follower view and pass the current user id */
<span class="nc" id="L91">        friends.setOnClickListener(v -&gt; {</span>
<span class="nc" id="L92">            Intent tempMain = new Intent(OtherUserProfile.this, FollowerView.class);</span>
<span class="nc" id="L93">            tempMain.putExtra(&quot;userId&quot;, otherUserId);</span>
<span class="nc" id="L94">            startActivity(tempMain);</span>
<span class="nc" id="L95">        });</span>

<span class="nc" id="L97">        back.setOnClickListener(v -&gt; {</span>
<span class="nc" id="L98">            Intent resultIntent = new Intent();</span>
<span class="nc" id="L99">            resultIntent.putExtra(&quot;userId&quot;, userId);</span>
<span class="nc" id="L100">            setResult(RESULT_OK, resultIntent);</span>
<span class="nc" id="L101">            finish();</span>
<span class="nc" id="L102">        });</span>

<span class="nc bnc" id="L104" title="All 2 branches missed.">        if (otherUserId != -1) {</span>
<span class="nc" id="L105">            loadUserBio(otherUserId);</span>
<span class="nc" id="L106">            loadProfilePicture(otherUserId);</span>
<span class="nc" id="L107">            loadSpotifyStatus(otherUserId);</span>
        }
<span class="nc" id="L109">    }</span>

    @Override
    protected void onResume() {
<span class="nc" id="L113">        super.onResume();</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">        if (userId != -1) {</span>
<span class="nc" id="L115">            loadSpotifyStatus(userId);</span>
        }
<span class="nc" id="L117">    }</span>

    /* Load Spotify link status */
    private void loadSpotifyStatus(int otherUserId) {
<span class="nc" id="L121">        String url = BASE_URL + &quot;/api/spotify/token?uid=&quot; + otherUserId;</span>

<span class="nc" id="L123">        JsonObjectRequest request = new JsonObjectRequest(Request.Method.GET, url, null,</span>
                response -&gt; {
<span class="nc bnc" id="L125" title="All 2 branches missed.">                    if(response.has(&quot;accessToken&quot;)) {</span>
<span class="nc" id="L126">                        String spotifyId = response.optString(&quot;spotifyUserId&quot;, &quot;&quot;);</span>
<span class="nc" id="L127">                        showLinkedUI(spotifyId);</span>
<span class="nc bnc" id="L128" title="All 4 branches missed.">                    } else if (response.has(&quot;needsAuth&quot;) &amp;&amp; response.optBoolean(&quot;needsAuth&quot;, false)) {</span>
<span class="nc" id="L129">                        showNotLinkedUI();</span>
                    } else {
<span class="nc" id="L131">                        showNotLinkedUI();</span>
                    }
<span class="nc" id="L133">                },</span>
                error -&gt; {
<span class="nc" id="L135">                    Toast.makeText(OtherUserProfile.this, &quot;Failed to load Spotify status&quot;, Toast.LENGTH_SHORT).show();</span>
<span class="nc" id="L136">                    showNotLinkedUI();</span>
<span class="nc" id="L137">                });</span>

<span class="nc" id="L139">        requestQueue.add(request);</span>
<span class="nc" id="L140">    }</span>

    private void showNotLinkedUI() {
<span class="nc" id="L143">        spotifyStatusText.setText(&quot;Spotify account not linked&quot;);</span>
<span class="nc" id="L144">    }</span>

    private void showLinkedUI(String spotifyId) {
<span class="nc" id="L147">        spotifyStatusText.setText(&quot;Linked to Spotify \nID: &quot; + spotifyId);</span>
<span class="nc" id="L148">    }</span>

    /* Fetch profile picture from backend */
    private void loadProfilePicture(int id) {
<span class="nc" id="L152">        String url = BASE_URL + &quot;/users/&quot; + id;</span>
<span class="nc" id="L153">        JsonObjectRequest request = new JsonObjectRequest(Request.Method.GET, url, null, response -&gt; {</span>
<span class="nc" id="L154">            String base64Image = response.optString(&quot;picture&quot;, &quot;&quot;);</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">            if (!base64Image.isEmpty()) {</span>
<span class="nc" id="L156">                byte[] decodedString = Base64.decode(base64Image, Base64.DEFAULT);</span>
<span class="nc" id="L157">                Bitmap decodedBitmap = BitmapFactory.decodeByteArray(decodedString, 0, decodedString.length);</span>
<span class="nc" id="L158">                profilePicture.setImageBitmap(decodedBitmap);</span>
            }
<span class="nc" id="L160">        }, error -&gt; Toast.makeText(OtherUserProfile.this, &quot;Failed to load profile picture&quot;, Toast.LENGTH_SHORT).show());</span>
<span class="nc" id="L161">        requestQueue.add(request);</span>
<span class="nc" id="L162">    }</span>

    /* Fetch user bio from backend */
    private void loadUserBio(int id) {
<span class="nc" id="L166">        String url = BASE_URL + &quot;/users/&quot; + id;</span>
<span class="nc" id="L167">        JsonObjectRequest request = new JsonObjectRequest(Request.Method.GET, url, null, response -&gt; {</span>
<span class="nc" id="L168">            String bio = response.optString(&quot;bio&quot;, &quot;&quot;).trim();</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">            if (!bio.isEmpty()) {</span>
<span class="nc" id="L170">                bioView.setText(bio);</span>
<span class="nc" id="L171">                bioView.setVisibility(TextView.VISIBLE);</span>
            } else {
<span class="nc" id="L173">                bioView.setVisibility(TextView.GONE);</span>
            }
<span class="nc" id="L175">            String first = response.optString(&quot;firstname&quot;, &quot;&quot;);</span>
<span class="nc" id="L176">            String last = response.optString(&quot;lastname&quot;, &quot;&quot;);</span>
<span class="nc bnc" id="L177" title="All 4 branches missed.">            if (!first.isEmpty() || !last.isEmpty()) {</span>
<span class="nc" id="L178">                fullname.setText(first + &quot; &quot; + last);</span>
<span class="nc" id="L179">                fullname.setVisibility(TextView.VISIBLE);</span>
            }
<span class="nc" id="L181">        }, error -&gt; Toast.makeText(OtherUserProfile.this, &quot;Failed to load bio&quot;, Toast.LENGTH_SHORT).show());</span>
<span class="nc" id="L182">        requestQueue.add(request);</span>
<span class="nc" id="L183">    }</span>

    private void loadUserTags() {
<span class="nc" id="L186">        tagService.getUsersTags(new TagManager.TagListCallback() {</span>
            @Override
            public void onSuccess(JSONArray tags) {
<span class="nc" id="L189">                Log.i(&quot;LoadUserTags tags JSON Array&quot;, tags.toString());</span>
<span class="nc" id="L190">                userTagUIManager.displayOtherUserTags(tags, tagService);</span>
<span class="nc" id="L191">            }</span>

            @Override
            public void onError(String message) {
<span class="nc" id="L195">                Toast.makeText(OtherUserProfile.this, &quot;Failed to load tags&quot;, Toast.LENGTH_SHORT).show();</span>
<span class="nc" id="L196">            }</span>
        }, otherUserId);
<span class="nc" id="L198">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span>Generated by the Android Gradle plugin 8.13.0</div></body></html>